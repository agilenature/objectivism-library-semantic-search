---
phase: 16.1-stability-instrument-correctness-audit
plan: 03
type: execute
wave: 3
depends_on: ["16.1-02"]
files_modified:
  - .planning/phases/16.1-stability-instrument-correctness-audit/16.1-T0-BASELINE.md
  - .planning/STATE.md
autonomous: false

must_haves:
  truths:
    - "check_stability.py --sample-count 20 exits 0 (all 7 assertions PASS) against the live corpus"
    - "Full verbatim output recorded as new T=0 baseline in 16.1-T0-BASELINE.md"
    - "0 unresolved citations in A6 output"
    - "0 missed files in A7 output (tolerance=0)"
    - "Episode exclusion count (333) visible in A7 output"
    - "STATE.md updated: Phase 16.1 gate PASSED, Phase 16-02 temporal protocol resumes"
    - "If exit != 0: residual failures triaged with per-file analysis and remediation plan"
  artifacts:
    - path: ".planning/phases/16.1-stability-instrument-correctness-audit/16.1-T0-BASELINE.md"
      provides: "New T=0 baseline output replacing the T+24h FAIL"
      min_lines: 30
  key_links:
    - from: "16.1-T0-BASELINE.md"
      to: "scripts/check_stability.py"
      via: "Verbatim output from --sample-count 20 --verbose run"
      pattern: "VERDICT: STABLE"
---

<objective>
Run check_stability.py --sample-count 20 in a MANDATORY FRESH SESSION and record the output as the new T=0 baseline. This replaces the T+24h FAIL and unblocks Phase 16's temporal protocol.

Purpose: The stability instrument itself was the adversarial target in Plans 01-02. Now we verify the fixed instrument against the live corpus. A fresh session ensures no bias from the implementation session. The output becomes the new temporal stability reference point.

Output: 16.1-T0-BASELINE.md with verbatim output. STATE.md updated. Phase 16-02 unblocked (or residual failures triaged).
</objective>

<execution_context>
@/Users/david/.claude/get-shit-done/workflows/execute-plan.md
@/Users/david/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16.1-stability-instrument-correctness-audit/16.1-02-SUMMARY.md
@scripts/check_stability.py
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Plans 01-02 fixed check_stability.py's A6 and A7 false-negative modes. The instrument now uses SUBSTR-based exact-match lookup for citations and per-pattern query strategy with Episode exclusion for searchability.

MANDATORY: This plan MUST be run in a fresh Claude Code session. Run `/clear` before starting this plan. The implementation session (Plan 02) must not influence the verification session.
  </what-built>
  <how-to-verify>
1. Run `/clear` to start a fresh session
2. Execute: `python scripts/check_stability.py --store objectivism-library --sample-count 20 --verbose`
3. Record the FULL output verbatim
4. Expected: VERDICT: STABLE, exit 0, all 7 assertions PASS
5. Check specifically:
   - A6: "all N citations resolve to DB records" (0 unresolved)
   - A7: "all 20/20 sampled files retrievable ... (333 Episode files excluded, tolerance=0)"
6. If exit 0: type "approved" to proceed to Task 2
7. If exit 1: paste the full output -- Claude will triage the failures
  </how-to-verify>
  <resume-signal>Type "approved" with the full check_stability output, or paste the output for triage</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Record T=0 baseline and update STATE.md</name>
  <files>
    .planning/phases/16.1-stability-instrument-correctness-audit/16.1-T0-BASELINE.md
    .planning/STATE.md
  </files>
  <action>
**If exit 0 (PASS path):**

Create `.planning/phases/16.1-stability-instrument-correctness-audit/16.1-T0-BASELINE.md`:

```markdown
# Phase 16.1: New T=0 Baseline

**Date:** [timestamp from check_stability output]
**Command:** `python scripts/check_stability.py --store objectivism-library --sample-count 20 --verbose`
**Exit code:** 0
**Verdict:** STABLE

## Replaces

T+24h check from 2026-02-24 10:12:41 UTC (5/7 PASS, A6 FAIL, A7 FAIL).
Phase 16.1 fixed check_stability.py's false-negative modes in A6 and A7.

## Full Output

```
[VERBATIM OUTPUT FROM CHECKPOINT - paste exactly as received]
```

## Assertion Summary

| Assertion | Result | Detail |
|-----------|--------|--------|
| A1 Count invariant | PASS | [from output] |
| A2 DB->Store | PASS | [from output] |
| A3 Store->DB | PASS | [from output] |
| A4 No stuck | PASS | [from output] |
| A5 Search results | PASS | [from output] |
| A6 Citation resolution | PASS | [from output] |
| A7 Per-file searchability | PASS | [from output] |

## Phase 16 Temporal Protocol Status

This T=0 baseline replaces the failed T+24h check. Phase 16-02 temporal protocol resumes:
- T=0: THIS CHECK (above)
- T+4h: Schedule next check ~4h from now
- T+24h: BLOCKING gate for Phase 17
- T+36h: Final confirmation
```

Update `.planning/STATE.md`:
1. Change Phase 16.1 status from "NOT STARTED" to "COMPLETE"
2. Update plan count: "3 of 3 complete in Phase 16.1"
3. Add to Decisions:
   - [16.1-01]: SPIKE-EVIDENCE.md confirms identity contract (store_doc_id prefix), SUBSTR fix validity, Episode exclusion rationale
   - [16.1-02]: check_stability.py A6 fixed (SUBSTR lookup), A7 fixed (Episode exclusion + topic query + exact prefix match + zero tolerance)
   - [16.1-02]: database.py `get_file_metadata_by_store_doc_prefix()` added; citations.py 4-pass resolution chain
   - [16.1-03]: New T=0 baseline recorded. Phase 16 temporal protocol resumes from corrected baseline.
4. Update temporal stability log:
   - Add: `T=0 (corrected) (DATE): 7/7 PASS -- 1749 indexed, 0 orphans, 0 unresolved citations, A7 0/20 misses (333 Episode excluded, tolerance=0). Replaces T+24h FAIL from 2026-02-24 10:12:41 UTC.`
5. Update "Resume instruction" to: "Phase 16.1 COMPLETE. Next: 16-02 (temporal stability protocol). T+4h check should run ~4h from T=0 baseline above."
6. Remove Phase 16.1 blockers from Blockers/Concerns (A6 and A7 issues resolved)

**If exit 1 (FAIL path):**

Record the output in 16.1-T0-BASELINE.md with "FAIL" verdict. Analyze:
- Which assertion(s) failed?
- If A7: which specific files? Are they course files with ambiguous stems?
- Remediation options:
  a. Reduce --sample-count to 10 (lower probability of hitting ambiguous files)
  b. Add course-specific query construction (use course name + class number)
  c. Investigate whether `retrieved_context.document_name` is populated (stronger matching)

Update STATE.md to reflect partial progress. Phase 16-02 remains BLOCKED until exit 0 is achieved.
  </action>
  <verify>
1. File exists: `ls .planning/phases/16.1-stability-instrument-correctness-audit/16.1-T0-BASELINE.md`
2. Contains verbatim output: `grep "VERDICT" .planning/phases/16.1-stability-instrument-correctness-audit/16.1-T0-BASELINE.md`
3. STATE.md updated: `grep "16.1" .planning/STATE.md` shows COMPLETE (or BLOCKED if exit 1)
4. Temporal log updated: `grep "corrected" .planning/STATE.md`
  </verify>
  <done>
16.1-T0-BASELINE.md records the new T=0 baseline. STATE.md updated with Phase 16.1 completion status. If PASS: Phase 16-02 temporal protocol resumes. If FAIL: residual failures documented with remediation path.
  </done>
</task>

</tasks>

<verification>
Plan 16.1-03 verification checklist:
1. Fresh session was used (human-verify checkpoint enforces this)
2. check_stability.py --sample-count 20 was run against live corpus
3. Full output recorded verbatim in 16.1-T0-BASELINE.md
4. If PASS: 0 unresolved (A6), 0 missed (A7), 333 excluded (A7), tolerance=0
5. STATE.md reflects Phase 16.1 completion
6. Temporal stability log has new T=0 entry
7. Phase 16-02 status updated (unblocked or still blocked with reason)
</verification>

<success_criteria>
- check_stability.py exits 0 with all 7 assertions PASS at --sample-count 20
- New T=0 baseline replaces the T+24h FAIL from 2026-02-24
- Phase 16 temporal protocol can resume from this corrected baseline
- OR: residual failures are precisely identified with a remediation plan (not a vague "needs more work")
</success_criteria>

<output>
After completion, create `.planning/phases/16.1-stability-instrument-correctness-audit/16.1-03-SUMMARY.md`
</output>
