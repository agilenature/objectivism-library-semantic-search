# CLARIFICATIONS-ANSWERED.md

## Phase 15: Wave 7 â€” FSM Consistency and store-sync Contract

**Generated:** 2026-02-22
**Mode:** YOLO (balanced strategy â€” all consensus/recommended options chosen)
**Source:** Auto-generated by discuss-phase-ai --yolo

---

## Decision Summary

**Total questions:** 8
**Tier 1 (Blocking):** 4 answered
**Tier 2 (Important):** 3 answered
**Tier 3 (Polish):** 1 answered

---

## Tier 1: Blocking Decisions

### Q1: What does "searchable" mean operationally?

**YOLO DECISION:** âœ… **Option B â€” Targeted semantic search query returns target file**

**Rationale:**
- Confidence: âœ… All 3 providers agreed
- list_store_documents() is insufficient â€” measures metadata ingestion, not search functionality
- "Searchable" = targeted query against actual file content returns target file in top-10 results
- Uses same code path as end-user CLI (validates the user-facing experience)
- Per-file queries crafted from actual content of Phase 12 corpus files

**Sub-decisions:**
- Top-N threshold: **top-10** (standard semantic search; top-1 is too strict for meaning-based retrieval)
- Query design: per-file natural language queries using unique Objectivist terminology from each file
- Search path: same as CLI `search` command (not raw embeddings API)

---

### Q2: What is T=0 for the lag measurement?

**YOLO DECISION:** âœ… **Option A â€” T=0 when upload+import API returns success**

**Rationale:**
- Confidence: âœ… Recommended by Gemini + Perplexity; consistent with Phase 11 methodology
- Clean, observable moment in existing code (FSM state write to PROCESSING happens at same time)
- Captures "Gemini accepted the file" from caller's perspective
- Strategy: record all 3 timestamps per file:
  - T_import = upload+import API returns success
  - T_listed = first appearance in list_store_documents()
  - T_searchable = first targeted search query hit
- Lag reported = T_searchable - T_import
- Also report T_listed - T_import to characterize the listing gap (Phase 11 found this is ~0.25s)

---

### Q3: When is a file a "silent failure"?

**YOLO DECISION:** âœ… **300 seconds (5 minutes) hard timeout = silent failure**

**Rationale:**
- Confidence: âœ… Recommended by Gemini + Perplexity
- 300s gives 1200x headroom over Phase 11's P99=0.253s for listing
- Sufficient to distinguish transient slowness from genuine silent failure
- Silent failures: reported separately as failure_rate (not included in P50/P95/max)
- Polling strategy: 1s â†’ 2s â†’ 4s â†’ 8s â†’ 16s â†’ 30s (cap), repeat until 300s elapsed

---

### Q4: FSM says INDEXED, store-sync can't verify â€” who wins?

**YOLO DECISION:** âœ… **Option A â€” Store-sync (empirical searchability) is authoritative**

**Rationale:**
- Confidence: âœ… All 3 providers agreed
- INDEXED must mean "actually searchable," not "upload succeeded"
- Resolution policy:
  1. If targeted search query fails after 300s: log as INCONSISTENT with timestamp and query used
  2. Downgrade FSM state to FAILED (direct DB write, same as existing retry_failed_file() pattern)
  3. Existing retry path handles re-upload (Phase 12 design â€” no new FSM states needed)
  4. No auto-deletes: store-sync reports orphans; operator runs store-sync to purge
- Contract statement: "FSM owns state transitions via API success codes; store-sync verifies actual searchability; disagreement resolved by downgrading FSM state"

---

## Tier 2: Important Decisions

### Q5: Test file selection and per-file query design?

**YOLO DECISION:** âœ… **20 files from Phase 12 corpus, queries from actual file content**

**Rationale:**
- Confidence: âœ… Follows from user constraint (no sentinel injection, no generic queries)
- Selection criteria: 20 files with philosophically specific, distinctive content
- Query design process (part of 15-01 plan):
  1. Read first 500 chars of each candidate file
  2. Identify unique proper nouns, philosophical terms, or specific claims
  3. Craft query: "What does the library say about [unique term/concept]?"
  4. Pre-validation: run each query against live store, confirm target file appears in results
  5. Document: file_path â†’ query â†’ expected_result_position table in script/report
- If a file fails pre-validation (query doesn't return it), select a different file

---

### Q6: How to report P50/P95/P99 with n=20?

**YOLO DECISION:** âœ… **Report P50/P95/empirical max with explicit statistical caveat**

**Rationale:**
- Confidence: âœ… Recommended by OpenAI
- Method: nearest-rank on n=20 successful measurements (excluding silent failures)
- Report format:
  - P50: nearest-rank
  - P95: nearest-rank
  - P99/max: empirical max, labeled "P99/max (n=20, empirical bound)"
  - failure_rate: N_silent_failures / 20
- VLID-07 requires "at least 20 test imports" â€” 20 is the minimum; this is satisfied
- Add note: "Statistical P99 requires nâ‰¥100; empirical max from n=20 is a conservative upper bound"

---

### Q7: What is store-sync's ongoing role?

**YOLO DECISION:** âœ… **Option B â€” Scheduled + targeted post-run (not routine per file, not emergency-only)**

**Rationale:**
- Confidence: âœ… Recommended by OpenAI + Perplexity
- Policy (to be documented in 15-02):
  - After each fsm-upload batch run: run `store-sync` to clear retry-path orphans (addresses the known blocker)
  - After any batch >50 files: run comprehensive `store-sync` validation
  - Emergency trigger: check_stability.py reports UNSTABLE
  - Escalation clause: if Phase 15 measurements show any silent failures â†’ upgrade to routine-after-each-batch
- Contract: "store-sync is a post-batch reconciliation tool, not an upload-pipeline component"
- This decision is provisional pending Phase 15 measurement results

---

## Tier 3: Polish Decisions

### Q8: Does temporal stability require fresh Claude sessions?

**YOLO DECISION:** âœ… **Option A â€” Stateless standalone script, SKEPTICAL posture**

**Rationale:**
- Confidence: âœ… Recommended by Gemini; Perplexity agrees on stateless execution
- check_stability.py is already stateless (Phase 8 design): new process, new DB connection, new API client
- Phase 15 distrust level is SKEPTICAL (not HOSTILE like Phases 9-11)
- SKEPTICAL posture: "script output is authoritative; Claude reads verbatim and reports"
- Fresh Claude sessions NOT required for T+4h/T+24h checks
- Document this explicitly in 15-02 plan to avoid Phase 12 ceremony being applied unnecessarily

---

## User-Specified Constraint (carried forward to all plans)

> **Plan 15-01 design constraint:** The lag measurement script must run targeted queries against the specific content of the 20 test files â€” not rely on the default check_stability.py query â€” to verify those files are actually searchable, not just listed.

This constraint drives Q1, Q5, and the 15-01 implementation structure:
- Per-file query table is a required artifact of Plan 15-01
- Each query must be pre-validated before use in lag measurement
- check_stability.py is used for STAB-04 temporal checks only; lag measurement uses a separate script

---

## Next Steps

1. âœ… Clarifications answered (YOLO mode)
2. â­ Proceed to `/gsd:plan-phase 15` to create 15-01-PLAN.md and 15-02-PLAN.md
3. ğŸ“‹ Review YOLO decisions during implementation if behavior differs from expectations

---

*Auto-generated by discuss-phase-ai --yolo (balanced strategy â€” all consensus/recommended options)*
*Human review recommended before final implementation*
*Generated: 2026-02-22*
