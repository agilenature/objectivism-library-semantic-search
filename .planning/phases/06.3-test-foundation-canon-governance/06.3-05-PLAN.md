---
phase: 06.3-test-foundation-canon-governance
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.claude/skills/canon-init/workflows/gsd.md
  - ~/.claude/skills/canon-init/workflows/ralph.md
  - ~/.claude/skills/canon-init/workflows/bmad.md
  - ~/.claude/skills/canon-init/workflows/generic.md
  - ~/.claude/skills/canon-update/workflows/gsd.md
  - ~/.claude/skills/canon-update/workflows/ralph.md
  - ~/.claude/skills/canon-update/workflows/bmad.md
  - ~/.claude/skills/canon-update/workflows/generic.md
autonomous: true


must_haves:
  truths:
    - "Each workflow file documents detection signals (file paths, patterns, names)"
    - "Each workflow file documents how to read project state from that workflow's control documents"
    - "GSD detection signals include .planning/STATE.md and .planning/ROADMAP.md"
    - "Ralph detection signals are researched from frankbria/ralph-claude-code repository"
    - "BMAD detection signals are researched from bmad-code-org/BMAD-METHOD repository"
    - "Generic fallback handles pyproject.toml, package.json, and README.md projects"
  artifacts:
    - path: "~/.claude/skills/canon-init/workflows/gsd.md"
      provides: "GSD workflow detection signals and project state reading instructions"
      min_lines: 30
    - path: "~/.claude/skills/canon-init/workflows/ralph.md"
      provides: "Ralph workflow detection signals and project state reading instructions"
      min_lines: 30
    - path: "~/.claude/skills/canon-init/workflows/bmad.md"
      provides: "BMAD workflow detection signals and project state reading instructions"
      min_lines: 30
    - path: "~/.claude/skills/canon-init/workflows/generic.md"
      provides: "Generic fallback detection and basic project reading"
      min_lines: 20
  key_links:
    - from: "~/.claude/skills/canon-init/workflows/gsd.md"
      to: ".planning/STATE.md"
      via: "Detection signal: file existence check"
      pattern: "STATE\\.md"
    - from: "~/.claude/skills/canon-init/workflows/ralph.md"
      to: "Ralph control documents"
      via: "Detection signal: file existence check"
      pattern: "detection_signals"
---

<objective>
Research GSD, Ralph (frankbria/ralph-claude-code), and BMAD (bmad-code-org/BMAD-METHOD) workflow methodologies to identify their control documents, detection signals, and project state encoding. Produce workflow reference files for both canon-init and canon-update skills.

Purpose: The canon-init and canon-update skills (plans 06-07) need to detect which workflow a project uses and read its state. This research wave produces the data files those skills consume.
Output: 8 workflow reference files (4 for canon-init, 4 for canon-update) covering GSD, Ralph, BMAD, and Generic.
</objective>

<execution_context>
@/Users/david/.claude/get-shit-done/workflows/execute-plan.md
@/Users/david/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.3-test-foundation-canon-governance/CANON-CONTEXT.md
@.planning/phases/06.3-test-foundation-canon-governance/06.3-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Research GSD, Ralph, and BMAD workflows and create workflow reference files</name>
  <files>~/.claude/skills/canon-init/workflows/gsd.md, ~/.claude/skills/canon-init/workflows/ralph.md, ~/.claude/skills/canon-init/workflows/bmad.md, ~/.claude/skills/canon-init/workflows/generic.md</files>
  <action>
Create the directory structure first:
```bash
mkdir -p ~/.claude/skills/canon-init/workflows
mkdir -p ~/.claude/skills/canon-update/workflows
```

**Research step:** Use WebFetch or WebSearch to research the two external repositories:
1. **Ralph:** https://github.com/frankbria/ralph-claude-code — Find what control files Ralph uses, how it tracks project state, what configuration/directory conventions it follows.
2. **BMAD:** https://github.com/bmad-code-org/BMAD-METHOD and https://docs.bmad-method.org/ — Find what control files BMAD uses, how it structures projects, what its configuration conventions are.

GSD is already well-understood from this project (no external research needed).

**For each workflow (GSD, Ralph, BMAD, Generic), create a reference file with this structure:**

```markdown
# {Workflow Name} Workflow Reference

## Detection Signals

Files/patterns whose presence indicates this workflow is in use:

| Signal | Path Pattern | Required | Notes |
|--------|-------------|----------|-------|
| ... | ... | ... | ... |

## Detection Logic

```
Check for:
1. [primary signal] — REQUIRED
2. [secondary signal] — CONFIRMS
3. [absence of] — RULES OUT
```

## Project State Reading

How to extract project context from this workflow's control documents:

### Project Title / Description
- Read from: [specific file and field]

### Current Phase / Milestone
- Read from: [specific file and field]

### Public Surface (for Canon.json folders)
- Infer from: [how to determine which folders contain public API]

### Internal Modules (for Canon.json excludeFolders)
- Infer from: [how to determine which folders are internal]

### Key Rules / Constraints
- Read from: [where workflow-specific constraints are documented]

## canon-init Guidance

What canon-init should do when this workflow is detected:
- [specific template variables to fill]
- [specific rules to include]
- [specific folder patterns to include/exclude]

## canon-update Guidance

What canon-update should audit when this workflow is detected:
- [what files to check for drift]
- [what state changes indicate Layer 1 needs update]
```

**GSD (gsd.md) — Already known, document from this project's experience:**
- Detection: `.planning/STATE.md` + `.planning/ROADMAP.md` present
- State: phases, plans, decisions from STATE.md; phase goals from ROADMAP.md
- Public surface: `src/` minus internal pipelines; `docs/` always public
- Internal: `.planning/`, `tests/`, `data/`, `scripts/`
- Rules: Phase execution workflow, Canon.json Layer 1 update after each phase

**Ralph (ralph.md) — Research from frankbria/ralph-claude-code:**
- Detection signals from repo inspection
- Control documents, directory conventions
- How Ralph tracks project state

**BMAD (bmad.md) — Research from bmad-code-org/BMAD-METHOD:**
- Detection signals from repo/docs inspection
- Control documents, directory conventions
- How BMAD tracks project state

**Generic (generic.md):**
- Fallback when no workflow detected
- Detection: pyproject.toml, package.json, or README.md present
- State: Read project name/description from manifest file
- Public surface: Infer from src/ or lib/ directory presence
- Internal: Common patterns (tests/, scripts/, config files)
  </action>
  <verify>
Verify all 4 files exist and contain the required sections:
```bash
for f in gsd.md ralph.md bmad.md generic.md; do
  echo "=== $f ==="
  test -f ~/.claude/skills/canon-init/workflows/$f && echo "EXISTS" || echo "MISSING"
  head -5 ~/.claude/skills/canon-init/workflows/$f 2>/dev/null
done
```
  </verify>
  <done>4 workflow reference files created for canon-init with concrete detection signals, project state reading instructions, and canon guidance for GSD (from direct experience), Ralph (from repo research), BMAD (from repo/docs research), and Generic (fallback).</done>
</task>

<task type="auto">
  <name>Task 2: Create canon-update workflow files (copy + adapt from canon-init versions)</name>
  <files>~/.claude/skills/canon-update/workflows/gsd.md, ~/.claude/skills/canon-update/workflows/ralph.md, ~/.claude/skills/canon-update/workflows/bmad.md, ~/.claude/skills/canon-update/workflows/generic.md</files>
  <action>
The canon-update workflow files share the same detection signals as canon-init (the workflow detection logic is identical). The difference is in the "Guidance" section: canon-update focuses on **auditing drift** rather than **initial setup**.

For each workflow, create the canon-update version by:
1. Copy the detection signals and project state reading sections from the canon-init version
2. Replace the "canon-init Guidance" section with a "Layer 1 Audit Checklist" section

The Layer 1 Audit Checklist should include:

```markdown
## Layer 1 Audit Checklist

When auditing a project using this workflow:

### Folder Drift
- [ ] Check for new public modules not in Canon.json `folders`
- [ ] Check for new internal modules not in Canon.json `excludeFolders`
- [ ] [Workflow-specific checks]

### Rule Drift
- [ ] Check if new constraints from recent work should be added to `rules`
- [ ] Check if existing rules are still accurate
- [ ] [Workflow-specific rule checks]

### State Synchronization
- [How to read current state for comparison]
- [What state changes indicate Canon.json needs update]

### Layer 2 Check
- [ ] Is this a milestone boundary? (If yes, flag previousVersions update)
- [How to detect milestone boundaries in this workflow]
```

Adapt the audit checklist for each workflow:
- **GSD:** Check .planning/STATE.md for completed phases; new modules from recent plans
- **Ralph:** Check Ralph's equivalent state tracking for completed work
- **BMAD:** Check BMAD's state encoding for milestone boundaries
- **Generic:** Check git tags or CHANGELOG for version changes
  </action>
  <verify>
Verify all 4 canon-update workflow files exist:
```bash
for f in gsd.md ralph.md bmad.md generic.md; do
  echo "=== $f ==="
  test -f ~/.claude/skills/canon-update/workflows/$f && echo "EXISTS" || echo "MISSING"
  head -5 ~/.claude/skills/canon-update/workflows/$f 2>/dev/null
done
```

Verify detection signal sections are present in all 8 files:
```bash
grep -l "Detection Signals" ~/.claude/skills/canon-init/workflows/*.md ~/.claude/skills/canon-update/workflows/*.md | wc -l
```
Should output 8.
  </verify>
  <done>8 total workflow reference files: 4 for canon-init (setup guidance) and 4 for canon-update (audit checklists). Detection signals consistent across both skill directories. Ralph and BMAD signals populated from external research.</done>
</task>

</tasks>

<verification>
- 8 workflow files exist (4 in canon-init/workflows, 4 in canon-update/workflows)
- Each file has Detection Signals, Detection Logic, Project State Reading sections
- GSD signals match known patterns (.planning/STATE.md + .planning/ROADMAP.md)
- Ralph signals come from actual repo inspection (not guesses)
- BMAD signals come from actual repo/docs inspection (not guesses)
- Generic covers pyproject.toml, package.json, README.md fallbacks
</verification>

<success_criteria>
- All 8 workflow reference files created with concrete, researched content
- Detection signals are specific enough for plans 06-07 to implement detection algorithm
- GSD workflow file is accurate based on direct experience with this project
- Ralph and BMAD workflow files are accurate based on external research
- Generic fallback covers common project structures
</success_criteria>

<output>
After completion, create `.planning/phases/06.3-test-foundation-canon-governance/06.3-05-SUMMARY.md`
</output>
