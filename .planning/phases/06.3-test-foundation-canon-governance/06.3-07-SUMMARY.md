---
phase: 06.3-test-foundation-canon-governance
plan: 07
subsystem: governance
tags: [canon, skills, audit, drift-detection, documentation]

# Dependency graph
requires:
  - phase: 06.3-05
    provides: Workflow reference files for GSD, Ralph, BMAD, Generic in canon-update/workflows/
provides:
  - canon-update SKILL.md with 6-step Layer 1 audit algorithm
  - Lightweight Canon drift check integrated into /update-docs command
affects: [06.3-08-apply-canon, phase-7-tui]

# Tech tracking
tech-stack:
  added: []
  patterns: [skill-based-governance, read-only-audit-hook, layer-separation]

key-files:
  created:
    - ~/.claude/skills/canon-update/SKILL.md
  modified:
    - .claude/commands/update-docs.md

key-decisions:
  - "Canon audit step in update-docs is read-only -- reports drift but never modifies Canon.json"
  - "Full audit with auto-update deferred to /canon-update skill invocation"
  - "Layer 2 version check is advisory only -- no auto-update of previousVersions"

patterns-established:
  - "Read-only audit hook: lightweight checks embedded in existing workflows detect drift without making changes"
  - "Full audit separation: detection (update-docs) vs correction (canon-update) split across two surfaces"

# Metrics
duration: 2min
completed: 2026-02-18
---

# Phase 6.3 Plan 07: Canon Update Skill Summary

**canon-update SKILL.md with 6-step Layer 1 audit algorithm (workflow detection, drift scanning, advisory reporting) plus lightweight Canon check hooked into /update-docs**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-18T20:58:16Z
- **Completed:** 2026-02-18T21:00:58Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- Created canon-update SKILL.md (206 lines) with complete Layer 1 audit algorithm covering workflow detection, Canon.json parsing, codebase scanning, drift detection, update/report, and Layer 2 advisory
- Added Step 5 to update-docs.md for lightweight read-only Canon.json drift detection
- Skill supports all 4 workflows (GSD, Ralph, BMAD, Generic) via workflow reference files from plan 05

## Task Commits

Each task was committed atomically:

1. **Task 1: Create canon-update SKILL.md** - no project commit (file is at ~/.claude/skills/, outside project git repo)
2. **Task 2: Hook lightweight Canon audit into /update-docs** - `1f5390c` (feat)

**Plan metadata:** (see final commit below)

## Files Created/Modified
- `~/.claude/skills/canon-update/SKILL.md` - Main skill prompt with 6-step Layer 1 audit algorithm, workflow detection, drift detection for folders/rules/files, Layer 2 advisory
- `.claude/commands/update-docs.md` - Added Step 5: Canon.json Layer 1 Audit (lightweight read-only check for unclassified and stale directories)

## Decisions Made
- Canon audit step in update-docs is strictly read-only -- it reports drift but never modifies Canon.json, directing users to `/canon-update` for full audit with corrections
- Layer 2 version checks are advisory only -- canon-update reports milestone boundary detection but does NOT auto-update `previousVersions` (that requires deliberate human decision)
- SKILL.md uses same workflow detection algorithm as canon-init (check `_canon_workflow` field first, then fall through detection chain)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

The parallel plan 06 agent created .claude/commands/update-docs.md as a new file in the same commit window. Since plan 07 only ADDS to the file (Step 5 appended), the content merged cleanly -- the committed file contains all original Steps 1-4 plus the new Step 5 Canon audit.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- canon-update skill is complete and ready for use on any project
- update-docs now includes Canon governance check
- Plan 08 can run `/canon-update` on this project to verify drift detection works end-to-end
- All 4 workflow files (from plan 05) are referenced by SKILL.md

---
*Phase: 06.3-test-foundation-canon-governance*
*Completed: 2026-02-18*
