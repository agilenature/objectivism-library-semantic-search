---
plan: 16.6-03
phase: 16.6-crad
status: complete
gate: PASS
completed: 2026-02-26
autonomous: false
---

# Summary: Plan 16.6-03 — A7 Update + Stability Gate

## What Was Built

Permanent CRAD integration: discrimination phrases embedded in identity headers, and A7
stability instrument updated to use CRAD phrases as fallback before S4a.

- **`src/objlib/upload/header_builder.py`**: `Discrimination:` field added. When a file has a
  validated phrase in `file_discrimination_phrases`, it appears in the identity header:
  `Discrimination: Zeno's arrow paradox`. Conditional on `validation_status='validated'`.
- **`scripts/check_stability.py`** A7: CRAD fallback inserted between S1 and S4a.
  Main sample query extended with `LEFT JOIN file_discrimination_phrases`. For each sampled
  file that S1 fails on, A7 now tries the CRAD phrase before S4a rarest-aspects.

## Gate Verdict: PASS

Three consecutive STABLE runs with 20/20 A7 hits, zero exclusions:

| Run | Time (UTC) | A7 | Verdict |
|-----|------------|-----|---------|
| 1 | 2026-02-26 22:06:32 | 20/20 | ✅ STABLE |
| 2 | 2026-02-26 22:08:48 | 20/20 | ✅ STABLE |
| 3 | 2026-02-26 22:11:00 | 20/20 | ✅ STABLE |

All 7 assertions passed in all 3 runs. Zero stochastic variance. Zero exclusions.
DB: 1749 indexed, store: 1749 docs, orphans: 0.

## Key Design

**Query hierarchy in A7 after this plan:**
1. **S1**: `"What is '{stem}' about?"` — covers most files (semantically rich stems)
2. **CRAD**: `file_discrimination_phrases.phrase` — for the 63 S1-failing class-number files
3. **S4a**: top-3 rarest aspects (stochastic fallback, now rarely needed)

**Why CRAD before S4a:** CRAD phrases are empirically validated at best_rank ≤ 5 across 3
runs. S4a is stochastic (aspects change retrieval rank unpredictably). CRAD is deterministic
where it applies. S4a remains as backstop for any file without a validated CRAD phrase.

**header_builder.py is the long-term fix:** Every future upload (via FSM pipeline, re-upload,
or new file ingest) will now automatically inject the `Discrimination:` field when a validated
phrase exists in the DB. No manual injection needed.

## Self-Check: PASSED

- [x] `header_builder.py`: `Discrimination:` field added, conditional on validated phrase
- [x] Header validated: ITOE AT Class 14-01 OH shows `Discrimination: Zeno's arrow paradox`
- [x] `check_stability.py` A7: CRAD fallback added between S1 and S4a
- [x] Sample query extended: LEFT JOIN with `file_discrimination_phrases`
- [x] Run 1 (22:06 UTC): STABLE 7/7, A7 20/20
- [x] Run 2 (22:08 UTC): STABLE 7/7, A7 20/20
- [x] Run 3 (22:11 UTC): STABLE 7/7, A7 20/20
- [x] STATE.md: Phase 16.6 COMPLETE, Phase 17 UNBLOCKED
- [x] Temporal stability log updated

## key-files

### modified
- src/objlib/upload/header_builder.py (`Discrimination:` field)
- scripts/check_stability.py (A7 CRAD fallback)
- .planning/STATE.md (Phase 16.6 COMPLETE, Phase 17 UNBLOCKED)

## Commits

(committed post-summary)
