---
phase: 12-50-file-fsm-upload
plan: 04
type: execute
wave: 4
depends_on: ["12-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "check_stability.py exit 0 at T+4h (no drift from T=0)"
    - "Orphan count unchanged from T=0 baseline"
    - "DB counts unchanged: 50 indexed, 50 with gemini_store_doc_id"
  artifacts:
    - path: ".planning/phases/12-50-file-fsm-upload/12-04-SUMMARY.md"
      provides: "T+4h drift check with comparison against T=0 baseline"
      min_lines: 20
  key_links: []
---

<objective>
T+4h temporal stability drift check. Compare system state against T=0 baseline from 12-03-SUMMARY.md.

Purpose: Detect any Gemini-side drift (silent document deletion, state changes, orphan accumulation) that occurs within the first 4 hours after upload. Early detection prevents false confidence at T+24h.

Output: 12-04-SUMMARY.md with drift analysis comparing T+4h readings to T=0 baseline.
</objective>

<execution_context>
@/Users/david/.claude/get-shit-done/workflows/execute-plan.md
@/Users/david/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-50-file-fsm-upload/12-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: T+4h drift check</name>
  <files>.planning/phases/12-50-file-fsm-upload/12-04-SUMMARY.md</files>
  <action>
CRITICAL PREREQUISITE: This plan MUST be executed in a FRESH Claude Code session.
Run `/clear` before starting this plan. This is not optional ceremony -- it is a core
validity requirement. A session that ran the T=0 checkpoint holds memory of what it found.
Claude's memory of "T=0 was clean" can unconsciously bias the T+4h verdict. A fresh
session must derive its conclusion entirely from script output, DB queries, and API calls.

**Step 1: Read T=0 baseline**
Read `.planning/phases/12-50-file-fsm-upload/12-03-SUMMARY.md` to get T=0 values:
- T=0 timestamp
- T=0 check_stability.py output and exit code
- T=0 DB counts (indexed count, gemini_store_doc_id count)
- T=0 store-sync dry-run output (canonical count, orphan count)

**Step 2: Run check_stability.py**
```bash
python scripts/check_stability.py --store objectivism-library
echo "Exit code: $?"
```
Record full output verbatim. Compare exit code to T=0 (expected: 0).

**Step 3: DB count queries**
```sql
SELECT COUNT(*) FROM files WHERE gemini_state='indexed';
SELECT COUNT(*) FROM files WHERE gemini_store_doc_id IS NOT NULL;
```
Record exact numbers. Compare to T=0 values (expected: identical).

**Step 4: store-sync dry-run**
```bash
python -m objlib store-sync --store objectivism-library
```
Record full output. Compare orphan count to T=0 (expected: identical or 0).

**Step 5: Drift analysis**
For each metric, compute delta from T=0:
- check_stability exit code: T=0 vs T+4h
- Indexed count: T=0 vs T+4h (expected delta: 0)
- Store doc count: T=0 vs T+4h (expected delta: 0)
- Orphan count: T=0 vs T+4h (expected delta: 0)

**Step 6: Verdict**
If ALL deltas are 0 and check_stability exit 0: **T+4h STABLE -- no drift detected**
If any delta != 0: **T+4h DRIFT DETECTED** -- document which metric changed and by how much

**Step 7: Record in SUMMARY.md**
Write 12-04-SUMMARY.md with:
- T+4h timestamp
- All raw output from steps 2-4
- Delta table comparing T=0 vs T+4h
- Verdict (STABLE or DRIFT)
- Hours elapsed since T=0
  </action>
  <verify>
12-04-SUMMARY.md exists with:
- T+4h timestamp and hours elapsed since T=0
- check_stability.py output with exit code
- DB counts with comparison to T=0
- store-sync output with comparison to T=0
- Delta table
- STABLE/DRIFT verdict
  </verify>
  <done>
T+4h drift check completed. Comparison against T=0 baseline recorded in 12-04-SUMMARY.md with delta analysis and verdict.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>T+4h temporal stability check completed. Results compared against T=0 baseline from 12-03-SUMMARY.md.</what-built>
  <how-to-verify>
    1. Review 12-04-SUMMARY.md drift analysis
    2. Confirm all deltas are 0 (no drift)
    3. Confirm check_stability.py exit 0
    4. If DRIFT detected, investigate before proceeding to T+24h
    5. Note: T+24h check (12-05) should happen ~24 hours after T=0, in a fresh session
  </how-to-verify>
  <resume-signal>Type "approved" if no drift detected, or describe drift issues found</resume-signal>
</task>

</tasks>

<verification>
1. check_stability.py exit 0 at T+4h
2. All DB counts match T=0 baseline
3. Orphan count unchanged from T=0
4. 12-04-SUMMARY.md records all comparisons
</verification>

<success_criteria>
- check_stability.py exit 0
- DB indexed count: same as T=0
- Store doc count: same as T=0
- Orphan count: same as T=0
- 12-04-SUMMARY.md has complete delta analysis
</success_criteria>

<output>
After completion, 12-04-SUMMARY.md IS the artifact for this plan.
</output>
